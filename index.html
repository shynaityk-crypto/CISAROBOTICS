<!doctype html>
<html lang="en" data-color-mode="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ArcheoHub Sovereign ‚Äî The Global Distributed Heritage Protocol</title>

  <link rel="stylesheet" href="https://unpkg.com/@primer/css@^21.0.0/dist/primer.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.js"></script>
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* -------------------------------------------------------------------------
       EXOTIC HUB THEME (Professional Dark Mode)
       ------------------------------------------------------------------------- */
    :root {
      --color-canvas-default: #010409;
      --color-canvas-subtle: #0d1117;
      --color-border-default: #30363d;
      --color-accent-emphasis: #1f6feb;
      --color-success-emphasis: #238636;
      --glow-gold: 0 0 15px rgba(210, 153, 34, 0.4);
    }

    body { background-color: var(--color-canvas-default); color: #c9d1d9; overflow-x: hidden; }
    
    /* Global Layout */
    .app-wrapper { display: flex; flex-direction: column; min-height: 100vh; }
    .main-viewport { flex: 1; padding: 32px; max-width: 1400px; margin: 0 auto; width: 100%; box-sizing: border-box; }

    /* Component: Global Header */
    .Header { background-color: var(--color-canvas-subtle); border-bottom: 1px solid var(--color-border-default); position: sticky; top: 0; z-index: 1000; }
    .brand-title { font-size: 1.5rem; font-weight: 800; letter-spacing: -1px; color: #fff; text-decoration: none; }
    .nav-link { color: #8b949e; transition: 0.2s; cursor: pointer; }
    .nav-link:hover { color: #fff; }

    /* Component: Site Map */
    #world-map { height: 500px; border-radius: 12px; border: 1px solid var(--color-border-default); margin-bottom: 24px; box-shadow: var(--glow-gold); }

    /* Component: Timeline Slider */
    .timeline-container { background: var(--color-canvas-subtle); padding: 40px 60px; border-radius: 12px; border: 1px solid var(--color-border-default); margin-bottom: 32px; }
    #timeline-slider { margin-top: 20px; }
    .noUi-connect { background: var(--color-accent-emphasis); }

    /* Component: Site Cards (The "Repo" Feel) */
    .site-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
    .site-card { 
      background: var(--color-canvas-subtle); border: 1px solid var(--color-border-default); 
      border-radius: 8px; padding: 16px; transition: transform 0.2s, border-color 0.2s;
      cursor: pointer; position: relative; overflow: hidden;
    }
    .site-card:hover { transform: translateY(-4px); border-color: #8b949e; }
    .site-card::after { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--color-accent-emphasis); }

    /* Auth Views */
    .auth-overlay { 
      position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; 
      display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px);
    }
    .auth-box { width: 400px; padding: 32px; background: var(--color-canvas-subtle); border: 1px solid var(--color-border-default); border-radius: 12px; }

    /* 3D Context Viewer */
    .viewer-3d-overlay { position: fixed; inset: 0; background: #000; z-index: 10001; display: flex; flex-direction: column; }
    #canvas-target { flex: 1; }

    /* Profile UI */
    .profile-header { display: flex; align-items: center; gap: 24px; margin-bottom: 32px; }
    .profile-avatar { width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--color-border-default); object-fit: cover; }

    /* Animations */
    .fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

<div id="app-shell" class="app-wrapper">
  <header class="Header px-4 py-3 d-flex flex-items-center flex-justify-between">
    <div class="d-flex flex-items-center">
      <a href="#" class="brand-title mr-4" onclick="App.router.go('explore')">ARCHEO<span style="color:var(--color-accent-emphasis)">HUB</span></a>
      <nav class="d-none d-md-flex gap-3">
        <a class="nav-link" onclick="App.router.go('explore')">Explore World</a>
        <a class="nav-link" onclick="App.router.go('map')">Global Atlas</a>
        <a class="nav-link" onclick="App.router.go('community')">Community Hub</a>
      </nav>
    </div>

    <div class="d-flex flex-items-center gap-3">
      <div id="auth-nav-area">
        </div>
    </div>
  </header>

  <main class="main-viewport fade-in" id="view-target"></main>

  <footer class="p-5 border-top border-default mt-5 text-center color-fg-muted f6">
    <div class="mb-2">¬© 2026 The ArcheoHub Sovereign Protocol ‚Ä¢ Distributed Heritage Data</div>
    <div class="d-flex flex-justify-center gap-3">
      <a href="#">Documentation</a>
      <a href="#">API</a>
      <a href="#">Whitepaper</a>
      <a href="#">KZ-Heritage-Vault</a>
    </div>
  </footer>
</div>

<div id="modal-layer"></div>
<div id="toast-container" style="position:fixed; bottom:20px; right:20px; z-index:11000;"></div>

<script>
/**
 * ARCHEOHUB SOVEREIGN ENGINE
 * A Massive Unified Framework for Archaeological Version Control
 */

const App = {
  state: {
    user: null, // Logged in user object
    currentView: 'explore',
    sites: [],
    filters: { yearRange: [-5000, 2026], search: '' },
    repos: []
  },

  // INITIALIZATION
  init: async function() {
    this.auth.loadSession();
    this.data.seedWorld();
    this.router.sync();
    this.ui.renderAuthNav();
    console.log("ArcheoHub Sovereign Initialized. Nodes Active:", this.state.sites.length);
  }
};

/* =========================================================================
   1. AUTHENTICATION SYSTEM
   ========================================================================= */
App.auth = {
  saveSession: (user) => {
    localStorage.setItem('archeo_user', JSON.stringify(user));
    App.state.user = user;
    App.ui.renderAuthNav();
  },
  loadSession: () => {
    const saved = localStorage.getItem('archeo_user');
    if (saved) App.state.user = JSON.parse(saved);
  },
  logout: () => {
    localStorage.removeItem('archeo_user');
    App.state.user = null;
    location.reload();
  },
  signup: (username, pfp) => {
    const user = {
      username,
      avatar: pfp || `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`,
      rank: 'Junior Field Researcher',
      contributions: 0,
      joined: new Date().getFullYear()
    };
    App.auth.saveSession(user);
    App.ui.toast("Welcome to the Protocol, " + username);
    App.router.go('explore');
  }
};

/* =========================================================================
   2. WORLD DATABASE (Massive Data Seeding)
   ========================================================================= */
App.data = {
  seedWorld: function() {
    const rawData = [
      // KAZAKHSTAN & CENTRAL ASIA
      { id: 'kz-tamgaly', name: 'Tamgaly Petroglyphs', region: 'Kazakhstan', period: 'Bronze Age', lat: 43.8, lon: 75.5, year: -1500, description: 'Ancient rock art depicting solar deities and nomadic life.' },
      { id: 'kz-otrar', name: 'Ancient Otrar', region: 'Kazakhstan', period: 'Medieval', lat: 42.8, lon: 68.3, year: 800, description: 'A massive Silk Road hub and center of learning.' },
      { id: 'kz-berel', name: 'Berel Mounds', region: 'Kazakhstan', period: 'Saka Period', lat: 49.3, lon: 86.4, year: -400, description: 'The "Valley of Kings" with preserved permafrost burials.' },
      { id: 'kz-issyk', name: 'Issyk Kurgan', region: 'Kazakhstan', period: 'Saka Period', lat: 43.3, lon: 77.4, year: -500, description: 'Discovery site of the Golden Man (Altin Adam).' },
      
      // EUROPE
      { id: 'eu-stonehenge', name: 'Stonehenge', region: 'UK', period: 'Neolithic', lat: 51.1, lon: -1.8, year: -3000, description: 'Prehistoric megalithic structure aligned with the solstices.' },
      { id: 'eu-pompeii', name: 'Pompeii City', region: 'Italy', period: 'Roman', lat: 40.7, lon: 14.4, year: 79, description: 'A city frozen in time by the eruption of Mt. Vesuvius.' },
      { id: 'eu-altamira', name: 'Altamira Cave', region: 'Spain', period: 'Paleolithic', lat: 43.3, lon: -4.1, year: -34000, description: 'Upper Paleolithic cave paintings of wild mammals.' },
      
      // ASIA (China, Japan, SE Asia)
      { id: 'as-terracotta', name: 'Terracotta Army', region: 'China', period: 'Qin Dynasty', lat: 34.3, lon: 109.2, year: -210, description: '8,000 unique life-sized soldiers guarding the First Emperor.' },
      { id: 'as-nara', name: 'Heijo-kyo Palace', region: 'Japan', period: 'Nara Period', lat: 34.6, lon: 135.8, year: 710, description: 'The grand capital of classical Japanese civilization.' },
      { id: 'as-angkor', name: 'Angkor Wat', region: 'Cambodia', period: 'Khmer Empire', lat: 13.4, lon: 103.8, year: 1150, description: 'The largest religious monument in the entire world.' },
      
      // AMERICAS (USA, Canada, South America)
      { id: 'am-machu', name: 'Machu Picchu', region: 'Peru', period: 'Inca Empire', lat: -13.1, lon: -72.5, year: 1450, description: 'The citadel in the clouds, a masterpiece of Incan masonry.' },
      { id: 'am-chaco', name: 'Chaco Canyon', region: 'USA', period: 'Puebloan', lat: 36.0, lon: -107.9, year: 900, description: 'Center of ancestral Puebloan culture in New Mexico.' },
      { id: 'am-lanse', name: 'L\'Anse aux Meadows', region: 'Canada', period: 'Viking Age', lat: 51.5, lon: -55.5, year: 1000, description: 'Evidence of Norse exploration of North America.' },
      { id: 'am-teotihuacan', name: 'Pyramid of the Sun', region: 'Mexico', period: 'Teotihuacan', lat: 19.6, lon: -98.8, year: 200, description: 'One of the most architecturally significant Mesoamerican pyramids.' }
    ];

    // Procedural Scaling: Generate 50 more simulated sites to populate the map
    for(let i=0; i<50; i++) {
      rawData.push({
        id: `gen-${i}`,
        name: `Research Site Alpha-${i}`,
        region: 'Global Exploration',
        period: 'Various',
        lat: (Math.random() * 140) - 70,
        lon: (Math.random() * 300) - 150,
        year: Math.floor(Math.random() * 6000) - 4000,
        description: 'Auto-detected heritage node pending verification.'
      });
    }
    this.App.state.sites = rawData;
  }
};

/* =========================================================================
   3. ROUTING & UI RENDERER
   ========================================================================= */
App.router = {
  go: function(view, id = null) {
    App.state.currentView = view;
    App.state.activeId = id;
    this.render();
  },
  sync: function() { this.render(); },
  render: function() {
    const target = document.getElementById('view-target');
    target.innerHTML = '';
    
    switch(App.state.currentView) {
      case 'explore': App.ui.views.explore(target); break;
      case 'map': App.ui.views.map(target); break;
      case 'profile': App.ui.views.profile(target); break;
      case 'auth': App.ui.views.auth(target); break;
      case 'repo': App.ui.views.repo(target, App.state.activeId); break;
    }
  }
};

App.ui = {
  // Global components
  toast: (msg) => {
    const t = document.createElement('div');
    t.className = 'Box Box--condensed p-3 mb-2 color-shadow-large color-bg-accent-emphasis color-fg-on-emphasis fade-in';
    t.innerText = msg;
    document.getElementById('toast-container').appendChild(t);
    setTimeout(() => t.remove(), 4000);
  },

  renderAuthNav: () => {
    const area = document.getElementById('auth-nav-area');
    if (App.state.user) {
      area.innerHTML = `
        <div class="d-flex flex-items-center gap-2">
          <span class="d-none d-md-block small color-fg-muted">${App.state.user.username}</span>
          <img src="${App.state.user.avatar}" class="avatar circle pointer" width="32" height="32" onclick="App.router.go('profile')">
          <button class="btn btn-sm btn-danger" onclick="App.auth.logout()">Out</button>
        </div>
      `;
    } else {
      area.innerHTML = `<button class="btn btn-primary btn-sm" onclick="App.router.go('auth')">Join Protocol</button>`;
    }
  },

  views: {
    auth: (target) => {
      target.innerHTML = `
        <div class="auth-overlay">
          <div class="auth-box fade-in">
            <h2 class="mb-3">Create Researcher ID</h2>
            <p class="color-fg-muted mb-4">Join the global distributed excavation network.</p>
            <div class="form-group">
              <label>Full Name</label>
              <input type="text" id="reg-name" class="form-control input-block" placeholder="Dr. Jones">
            </div>
            <div class="form-group">
              <label>Avatar URL (Optional)</label>
              <input type="text" id="reg-pfp" class="form-control input-block" placeholder="https://...">
            </div>
            <button class="btn btn-primary btn-block mt-4" onclick="App.auth.signup(document.getElementById('reg-name').value, document.getElementById('reg-pfp').value)">Initialize Account</button>
            <button class="btn btn-invisible btn-block mt-2" onclick="App.router.go('explore')">Cancel</button>
          </div>
        </div>
      `;
    },

    explore: (target) => {
      target.innerHTML = `
        <div class="timeline-container">
          <div class="d-flex flex-justify-between flex-items-center mb-2">
            <h3 class="f4">Chronological Horizon</h3>
            <span class="Label Label--info" id="year-label">-5000 BC to 2026 AD</span>
          </div>
          <div id="timeline-slider"></div>
          <div class="mt-4">
             <input type="text" class="form-control input-block input-lg color-bg-subtle" placeholder="Search by site name, culture, or region (e.g. 'Kazakhstan', 'Inca')..." id="site-search">
          </div>
        </div>

        <div class="site-grid" id="site-results"></div>
      `;

      // Init Timeline Slider
      const slider = document.getElementById('timeline-slider');
      noUiSlider.create(slider, {
        start: [-5000, 2026],
        connect: true,
        range: { 'min': -10000, 'max': 2026 },
        step: 10
      });

      const updateResults = () => {
        const [start, end] = slider.noUiSlider.get();
        document.getElementById('year-label').innerText = `${Math.round(start)} to ${Math.round(end)}`;
        
        const query = document.getElementById('site-search').value.toLowerCase();
        const filtered = App.state.sites.filter(s => {
          const matchYear = s.year >= start && s.year <= end;
          const matchText = s.name.toLowerCase().includes(query) || s.region.toLowerCase().includes(query);
          return matchYear && matchText;
        });

        document.getElementById('site-results').innerHTML = filtered.map(s => `
          <div class="site-card fade-in" onclick="App.router.go('repo', '${s.id}')">
            <div class="f3 text-bold color-fg-accent">${s.name}</div>
            <div class="f6 color-fg-muted mb-2">${s.region} ‚Ä¢ ${s.period}</div>
            <p class="f6">${s.description}</p>
            <div class="mt-3 d-flex gap-2">
              <span class="Label Label--secondary">${s.year < 0 ? Math.abs(s.year)+' BC' : s.year+' AD'}</span>
            </div>
          </div>
        `).join('');
      };

      slider.noUiSlider.on('update', updateResults);
      document.getElementById('site-search').oninput = updateResults;
      updateResults();
    },

    map: (target) => {
      target.innerHTML = `
        <div class="Subhead"><div class="Subhead-heading">Global GIS Distribution</div></div>
        <div id="world-map"></div>
        <div class="Box p-3">
          <div class="d-flex flex-justify-between">
            <div><strong>Active Nodes:</strong> ${App.state.sites.length}</div>
            <div><strong>Protocol Status:</strong> Synced</div>
          </div>
        </div>
      `;
      
      setTimeout(() => {
        const map = L.map('world-map').setView([30, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        App.state.sites.forEach(s => {
          const marker = L.circleMarker([s.lat, s.lon], { radius: 6, color: '#1f6feb', fillOpacity: 0.8 }).addTo(map);
          marker.bindPopup(`<b>${s.name}</b><br>${s.region}<br><button class="btn btn-sm mt-2" onclick="App.router.go('repo', '${s.id}')">Open Repo</button>`);
        });
      }, 100);
    },

    profile: (target) => {
      const u = App.state.user;
      if (!u) return App.router.go('auth');
      target.innerHTML = `
        <div class="profile-header">
          <img src="${u.avatar}" class="profile-avatar">
          <div>
            <h1 class="f1-light">${u.username}</h1>
            <p class="color-fg-muted">${u.rank} ‚Ä¢ Joined ${u.joined}</p>
            <div class="d-flex gap-2 mt-2">
              <button class="btn btn-sm">Edit Profile</button>
              <button class="btn btn-sm btn-primary">Publish Findings</button>
            </div>
          </div>
        </div>
        
        <div class="layout-main d-flex gap-4">
          <div class="col-8">
            <h3 class="mb-3">Contributions</h3>
            <div class="Box p-5 text-center color-fg-muted">
              No public findings yet. Start an excavation branch to begin.
            </div>
          </div>
          <div class="col-4">
             <div class="Box p-3">
               <h4 class="mb-2">Stats</h4>
               <ul class="list-style-none">
                 <li class="mb-1">‚≠ê Stars: 0</li>
                 <li class="mb-1">üç¥ Forks: 0</li>
                 <li class="mb-1">üåç Sites Visited: 4</li>
               </ul>
             </div>
          </div>
        </div>
      `;
    },

    repo: (target, siteId) => {
      const site = App.state.sites.find(s => s.id === siteId);
      target.innerHTML = `
        <div class="repo-header mb-4">
          <div class="d-flex flex-justify-between flex-items-start">
            <div>
              <nav aria-label="Breadcrumb"><ol>
                <li class="breadcrumb-item"><a href="#" onclick="App.router.go('explore')">World</a></li>
                <li class="breadcrumb-item breadcrumb-item-selected">${site.name}</li>
              </ol></nav>
              <h2 class="f1-light mt-2">${site.name} <span class="Label Label--secondary v-align-middle">Public</span></h2>
            </div>
            <div class="btn-group">
              <button class="btn btn-sm">Watch</button>
              <button class="btn btn-sm">Star</button>
              <button class="btn btn-sm">Fork</button>
            </div>
          </div>
        </div>

        <div class="UnderlineNav mb-4">
          <div class="UnderlineNav-body">
            <button class="UnderlineNav-item selected">Code (Layers)</button>
            <button class="UnderlineNav-item">Issues <span class="Counter">0</span></button>
            <button class="UnderlineNav-item">Pull Requests</button>
            <button class="UnderlineNav-item">Actions</button>
          </div>
        </div>

        <div class="Box mb-4">
          <div class="Box-header d-flex flex-justify-between">
            <span><strong>main</strong> branch</span>
            <button class="btn btn-sm btn-primary" onclick="App.ui.launch3D()">Open in 3D Context</button>
          </div>
          <div class="Box-row d-flex flex-justify-between">
             <div><span class="color-fg-accent mr-2">üìÅ</span> stratigraphy/</div>
             <span class="color-fg-muted f6">Initial Commit</span>
          </div>
          <div class="Box-row d-flex flex-justify-between">
             <div><span class="color-fg-accent mr-2">üìÑ</span> metadata.json</div>
             <span class="color-fg-muted f6">Update site year</span>
          </div>
          <div class="Box-row d-flex flex-justify-between">
             <div><span class="color-fg-accent mr-2">üìù</span> README.md</div>
             <span class="color-fg-muted f6">Add site description</span>
          </div>
        </div>

        <div class="Box p-4">
          <h3>README.md</h3>
          <hr>
          <p>${site.description}</p>
          <p class="mt-3"><strong>Period:</strong> ${site.period}</p>
          <p><strong>Coordinates:</strong> ${site.lat}, ${site.lon}</p>
        </div>
      `;
    }
  },

  /* =========================================================================
     4. 3D CONTEXT ENGINE
     ========================================================================= */
  launch3D: () => {
    const overlay = document.createElement('div');
    overlay.className = 'viewer-3d-overlay';
    overlay.innerHTML = `
      <div class="p-3 d-flex flex-justify-between border-bottom border-default">
        <h3 class="f4">Spatial Stratigraphy Viewer</h3>
        <button class="btn btn-danger btn-sm" onclick="this.parentElement.parentElement.remove()">Close</button>
      </div>
      <div id="canvas-target"></div>
    `;
    document.body.appendChild(overlay);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050505);
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('canvas-target').appendChild(renderer.domElement);

    // Create a mock excavation trench
    const layers = [
      { color: 0x4b3621, h: 0.5 }, // Topsoil
      { color: 0x8b4513, h: 1.2 }, // Bronze Age Layer
      { color: 0xd2b48c, h: 0.8 }  // Natural soil
    ];
    
    let y = 0;
    layers.forEach(l => {
      const geo = new THREE.BoxGeometry(10, l.h, 10);
      const mat = new THREE.MeshStandardMaterial({ color: l.color });
      const cube = new THREE.Mesh(geo, mat);
      cube.position.y = y;
      scene.add(cube);
      y -= l.h;
    });

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 5, 5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    camera.position.set(15, 5, 15);
    camera.lookAt(0, 0, 0);

    function animate() {
      if(!document.contains(overlay)) return;
      requestAnimationFrame(animate);
      scene.rotation.y += 0.005;
      renderer.render(scene, camera);
    }
    animate();
  }
};

// Start the Engine
App.init();
</script>
</body>
</html>
